<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bar-Blinker Control Panel</title>
  <style>
    /* Dark Theme Variables */
    :root {
      --primary: #3B82F6;
      --primary-hover: #2563EB;
      --success: #10B981;
      --success-hover: #059669;
      --danger: #EF4444;
      --danger-hover: #DC2626;
      --background: #111827;
      --card-bg: #1F2937;
      --text: #F3F4F6;
      --text-secondary: #9CA3AF;
      --border: #374151;
      --input-bg: #272F3D;
      --hover: #2D3748;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2);
      --accent: #4F46E5;
    }

    /* Basic Reset & Smooth Transitions */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      transition: all 0.2s ease;
    }

    /* Body Styling */
    body {
      font-family: Arial, sans-serif;
      background-color: var(--background);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
      padding: 1rem;
    }

    /* Responsive Container */
    .container {
      max-width: 800px;
      margin: 0 auto;
      width: 100%;
      padding: 0 1rem;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .header h1 {
      margin-bottom: 0.5rem;
      color: var(--text);
      font-size: 2rem;
      background: linear-gradient(to right, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .header p {
      color: var(--text-secondary);
      font-size: 1rem;
    }

    /* Cards */
    .card {
      background: var(--card-bg);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border-radius: 0.75rem;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 12px -1px rgba(0, 0, 0, 0.3);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }

    .section-title {
      display: flex;
      align-items: center;
      font-size: 1.2em;
      color: var(--text);
      gap: 0.5rem;
    }

    .section-icon {
      width: 24px;
      height: 24px;
      fill: var(--primary);
    }

    /* Forms */
    form {
      display: block;
      width: 100%;
    }

    /* Input Groups */
    .input-group {
      margin-bottom: 1rem;
    }

    .input-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text);
      font-weight: 500;
    }

    .input-group input,
    .input-group select {
      width: 100%;
      padding: 0.75rem 1rem;
      background: var(--input-bg);
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      color: var(--text);
      outline: none;
      font-size: 1rem;
    }

    .input-group input:focus,
    .input-group select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      cursor: pointer;
      text-decoration: none;
      font-size: 0.9em;
      border: none;
      color: #fff;
      transition: all 0.2s ease;
    }

    .btn svg {
      width: 16px;
      height: 16px;
    }

    .btn-primary {
      background-color: var(--primary);
    }
    .btn-primary:hover {
      background-color: var(--primary-hover);
      transform: translateY(-1px);
    }

    .btn-success {
      background-color: var(--success);
    }
    .btn-success:hover {
      background-color: var(--success-hover);
      transform: translateY(-1px);
    }

    .btn-danger {
      background-color: var(--danger);
    }
    .btn-danger:hover {
      background-color: var(--danger-hover);
      transform: translateY(-1px);
    }

    /* Radio Buttons (mode selection) */
    .mode-selection {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .mode-selection label {
      color: var(--text);
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      transition: background 0.2s;
    }

    .mode-selection label:hover {
      background: var(--hover);
    }

    .mode-selection input[type="radio"] {
      width: 1.25rem;
      height: 1.25rem;
      border-radius: 50%;
      border: 2px solid var(--border);
      appearance: none;
      position: relative;
      cursor: pointer;
    }
    .mode-selection input[type="radio"]:checked {
      border-color: var(--primary);
    }
    .mode-selection input[type="radio"]:checked::after {
      content: '';
      position: absolute;
      width: 0.75rem;
      height: 0.75rem;
      background: var(--primary);
      border-radius: 50%;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    /* Dropdown for Effects */
    .preset-group {
      display: none; /* Hidden by default */
    }

    /* Warnings and Descriptions */
    .warning {
      color: var(--danger);
      font-size: 0.9em;
      margin-top: 5px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .input-description {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-top: 0.375rem;
    }

    /* Grid Layout for Forms */
    .grid {
      display: grid;
      gap: 1rem;
    }
    .grid-2 {
      grid-template-columns: 1fr 1fr;
    }

    /* Footer */
    .footer {
      text-align: center;
      margin-top: 2rem;
      color: var(--text-secondary);
      font-size: 0.9em;
    }

    /* MEDIA QUERIES - Mobile Friendliness */
    @media (max-width: 640px) {
      .container {
        padding: 0 0.5rem;
      }

      .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }

      .section-title {
        font-size: 1rem;
      }

      /* Make forms stack vertically on mobile */
      .grid-2 {
        grid-template-columns: 1fr;
      }

      .mode-selection {
        flex-direction: column;
        gap: 0.5rem;
      }

      /* Buttons go full width on very small screens */
      .btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>

  <script>
    // JavaScript to handle dynamic enabling/disabling of effect selection
    document.addEventListener("DOMContentLoaded", function() {
      const modeRadios = document.querySelectorAll('input[name="mode"]');
      const effectSelect = document.getElementById('effect_index');
      const effectGroup = document.getElementById('effect_group');

      function toggleEffect() {
        if (document.querySelector('input[name="mode"]:checked').value === "effect") {
          effectSelect.disabled = false;
          effectGroup.style.display = "block";
        } else {
          effectSelect.disabled = true;
          effectGroup.style.display = "none";
        }
      }

      modeRadios.forEach(radio => {
        radio.addEventListener('change', toggleEffect);
      });

      // Initialize on page load
      toggleEffect();
    });
  </script>
</head>

<body class="dark">
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>Bar-Blinker Control Panel</h1>
      <p>Configure and manage your WLED Bar-Blinker device settings</p>
    </header>

    <!-- Test Controls -->
    <div class="card">
      <div class="card-header">
        <h2 class="section-title">
          <!-- SVG Icon -->
          <svg class="section-icon" viewBox="0 0 24 24">
            <path fill="currentColor" d="M8 5v14l11-7z"/>
          </svg>
          Test Controls
        </h2>
      </div>

      <form method="POST" action="{{ url_for('simulate_press') }}" class="test-controls">
        <button name="press_type" value="short" class="btn btn-primary" type="submit">
          <svg viewBox="0 0 24 24">
            <path fill="currentColor" d="M8 5v14l11-7z"/>
          </svg>
          Simulate Short Press
        </button>
        <button name="press_type" value="long" class="btn btn-primary" type="submit">
          <svg viewBox="0 0 24 24">
            <path fill="currentColor" d="M6 6h12v12H6z"/>
          </svg>
          Simulate Long Press
        </button>
      </form>
    </div>

    <!-- LED Mode Configuration -->
    <div class="card">
      <div class="card-header">
        <h2 class="section-title">
          <!-- SVG Icon -->
          <svg class="section-icon" viewBox="0 0 24 24">
            <path fill="currentColor"
                  d="M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6
                     6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4
                     4-4 4 1.79 4 4-1.79 4-4 4z"/>
          </svg>
          LED Mode Configuration
        </h2>
      </div>

      <form method="POST" action="{{ url_for('update_config') }}">
        <div class="mode-selection">
          <label>
            <input type="radio" name="mode" value="white"
                   {% if current_mode == "white" %}checked{% endif %}>
            Default White
          </label>
          <label>
            <input type="radio" name="mode" value="effect"
                   {% if current_mode == "effect" %}checked{% endif %}>
            WLED Effect
          </label>
        </div>

        <div class="input-group preset-group" id="effect_group">
          <label for="effect_index">Select Effect:</label>
          <select id="effect_index" name="effect_index">
            {% if effects %}
              {% for effect in effects %}
                <option value="{{ loop.index0 }}"
                  {% if loop.index0 == current_effect %}selected{% endif %}>
                  {{ effect }}
                </option>
              {% endfor %}
            {% else %}
              <option value="" disabled>No effects available</option>
            {% endif %}
          </select>
          <p class="input-description">Choose an effect from your WLED device</p>
        </div>

        <button type="submit" class="btn btn-success">
          Apply LED Mode
        </button>
      </form>
    </div>

    <!-- Hardware Configuration -->
    <div class="card">
      <div class="card-header">
        <h2 class="section-title">
          <!-- SVG Icon -->
          <svg class="section-icon" viewBox="0 0 24 24">
            <path fill="currentColor"
                  d="M22 9V7h-2V5c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2
                     2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-2h2v-2h-2v-2h2v-2h-2V9h2zm-4
                     10H4V5h14v14zM6 13h5v4H6zm6-6h4v3h-4zM6 7h5v5H6zm6 4h4v6h-4z"/>
          </svg>
          Hardware Configuration
        </h2>
      </div>

      <form method="POST" action="{{ url_for('update_config') }}">
        <div class="input-group">
          <label>GPIO Button Pin</label>
          <input type="number" name="BUTTON_PIN" value="{{ c.BUTTON_PIN }}" readonly>
          <div class="warning">
            <svg width="16" height="16" viewBox="0 0 24 24">
              <path fill="currentColor"
                    d="M12 21l-7-5 7-5 7 5-7 5zm0-16L5 10l7
                       5 7-5zM12 2l9 7-9 7-9-7 9-7z"/>
            </svg>
            Restart required if changed
          </div>
        </div>

        <div class="input-group">
          <label>WLED IP Address</label>
          <input type="text" name="WLED_IP" value="{{ c.WLED_IP }}" required>
          <p class="input-description">IP address of your WLED device on the local network</p>
        </div>

        <button type="submit" class="btn btn-success">
          Apply Hardware Settings
        </button>
      </form>
    </div>

    <!-- Timing Configuration -->
    <div class="card">
      <div class="card-header">
        <h2 class="section-title">
          <!-- SVG Icon -->
          <svg class="section-icon" viewBox="0 0 24 24">
            <path fill="currentColor"
                  d="M12 21l-7-5 7-5 7 5-7 5zm0-16L5 10l7 5
                     7-5zM12 2l9 7-9 7-9-7 9-7z"/>
          </svg>
          Timing Configuration
        </h2>
      </div>

      <form method="POST" action="{{ url_for('update_config') }}">
        <div class="grid grid-2">
          <div class="input-group">
            <label>Long Press Threshold (seconds)</label>
            <input type="number" name="LONG_PRESS_THRESHOLD"
                   value="{{ c.LONG_PRESS_THRESHOLD }}"
                   step="0.1" min="0.1" required>
            <p class="input-description">Seconds to hold for long press (green to red)</p>
          </div>

          <div class="input-group">
            <label>Short Flash Duration (seconds)</label>
            <input type="number" name="SHORT_FLASH_DURATION"
                   value="{{ c.SHORT_FLASH_DURATION }}"
                   step="0.1" min="0.1" required>
            <p class="input-description">How long to blink after button press</p>
          </div>

          <div class="input-group">
            <label>Flash Interval (seconds)</label>
            <input type="number" name="FLASH_INTERVAL"
                   value="{{ c.FLASH_INTERVAL }}"
                   step="0.1" min="0.1" required>
            <p class="input-description">Time between blinks (lower = faster)</p>
          </div>
        </div>

        <button type="submit" class="btn btn-success">
          Apply Timing Settings
        </button>
      </form>
    </div>

    <!-- LED Configuration -->
    <div class="card">
      <div class="card-header">
        <h2 class="section-title">
          <!-- SVG Icon -->
          <svg class="section-icon" viewBox="0 0 24 24">
            <path fill="currentColor"
                  d="M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6
                     6-2.69 6-6-2.69-6-6-6zm0 10c-2.21 0-4-1.79-4-4s1.79-4
                     4-4 4 1.79 4 4-1.79 4-4 4z"/>
          </svg>
          LED Configuration
        </h2>
      </div>

      <form method="POST" action="{{ url_for('update_config') }}">
        <div class="grid grid-2">
          <div class="input-group">
            <label>Flash Brightness (0-255)</label>
            <input type="number" name="FLASH_BRIGHTNESS" value="{{ c.FLASH_BRIGHTNESS }}"
                   min="0" max="255" required>
            <p class="input-description">LED brightness (0-255)</p>
          </div>

          <div class="input-group">
            <label>Transition Time (seconds)</label>
            <input type="number" name="TRANSITION_TIME"
                   value="{{ c.TRANSITION_TIME }}"
                   step="0.1" min="0" required>
            <p class="input-description">Color fade duration in seconds</p>
          </div>
        </div>

        <button type="submit" class="btn btn-success">
          Apply LED Settings
        </button>
      </form>
    </div>

    <!-- Connection Settings -->
    <div class="card">
      <div class="card-header">
        <h2 class="section-title">
          <!-- SVG Icon -->
          <svg class="section-icon" viewBox="0 0 24 24">
            <path fill="currentColor"
                  d="M12 21l-7-5 7-5 7 5-7 5zm0-16L5
                     10l7 5 7-5z"/>
          </svg>
          Connection Settings
        </h2>
      </div>

      <form method="POST" action="{{ url_for('update_config') }}">
        <div class="grid grid-2">
          <div class="input-group">
            <label>Maximum Retries</label>
            <input type="number" name="MAX_RETRIES" value="{{ c.MAX_RETRIES }}" min="1" required>
          </div>

          <div class="input-group">
            <label>Retry Delay (seconds)</label>
            <input type="number" name="RETRY_DELAY"
                   value="{{ c.RETRY_DELAY }}"
                   step="0.1" min="0.1" required>
          </div>

          <div class="input-group">
            <label>Reconnection Delay (seconds)</label>
            <input type="number" name="RECONNECT_DELAY"
                   value="{{ c.RECONNECT_DELAY }}"
                   step="0.1" min="0.1" required>
          </div>

          <div class="input-group">
            <label>Request Timeout (seconds)</label>
            <input type="number" name="REQUEST_TIMEOUT"
                   value="{{ c.REQUEST_TIMEOUT }}"
                   step="0.1" min="0.1" required>
          </div>
        </div>

        <button type="submit" class="btn btn-success">
          Apply Connection Settings
        </button>
      </form>
    </div>

    <!-- System Status -->
    <div class="card">
      <div class="card-header">
        <h2 class="section-title">
          <!-- SVG Icon -->
          <svg class="section-icon" viewBox="0 0 24 24">
            <path fill="currentColor"
                  d="M11 9h2V7h-2m1 13c-4.41 0-8-3.59-8-8s3.59-8
                     8-8 8 3.59 8 8-3.59 8-8 8m0-18A10 10 0 0 0
                     2 12a10 10 0 0 0 10 10 10 10 0 0 0
                     10-10A10 10 0 0 0 12 2m1 15h-2v2h2v-2zm0-6h-2v4h2v-4z"/>
          </svg>
          System Status
        </h2>
      </div>
      <div class="grid grid-2">
        <div class="input-group">
          <label>Log File Location</label>
          <input type="text" value="{{ c.LOG_FILE }}" readonly>
        </div>
        <div class="input-group">
          <label>Connection Status</label>
          <div class="warning">
            <svg width="16" height="16" viewBox="0 0 24 24">
              <path fill="currentColor"
                    d="M12 21l-7-5 7-5 7 5-7 5zm0-16L5
                       10l7 5 7-5zM12 2l9 7-9 7-9-7 9-7z"/>
            </svg>
            Check log file for detailed status information
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <p>&copy; 2025 Bar-Blinker Control Panel. All rights reserved.</p>
    </div>
  </div>
</body>
</html>
